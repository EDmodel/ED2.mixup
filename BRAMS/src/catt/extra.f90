!==========================================================================================!
!==========================================================================================!
!     Module with extra stuff used by CATT.                                                !
!------------------------------------------------------------------------------------------!
module extras


   implicit none

   integer, parameter :: na_extra2d=4
   integer, parameter :: na_extra3d=6

   type ext2d
      real, pointer, dimension(:,:)   :: d2
   end type ext2d
   type(ext2d), dimension(:,:), allocatable :: extra2d
   type(ext2d), dimension(:,:), allocatable :: extra2dm

   type ext3d
      real, pointer, dimension(:,:,:) :: d3
   end type ext3d
   type(ext3d), dimension(:,:), allocatable :: extra3d
   type(ext3d), dimension(:,:), allocatable :: extra3dm

   !=======================================================================================!
   !=======================================================================================!


   contains



   !=======================================================================================!
   !=======================================================================================!
   !    Allocate arrays.                                                                   !
   !---------------------------------------------------------------------------------------!
   subroutine alloc_extra2d(scal,m1,m2)

      implicit none
      !----- Arguments. -------------------------------------------------------------------!
      type (ext2d), intent(inout) :: scal
      integer     , intent(in)    :: m1   ! dimension of arrays
      integer     , intent(in)    :: m2   ! dimension of arrays
      !------------------------------------------------------------------------------------!

      allocate(scal%d2(m1,m2))

      return
   end subroutine alloc_extra2d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Deallocate arrays.                                                                 !
   !---------------------------------------------------------------------------------------!
   subroutine dealloc_extra2d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext2d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      if (associated(scal%d2)) deallocate(scal%d2)

      return
   end subroutine dealloc_extra2d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Nullify arrays.                                                                    !
   !---------------------------------------------------------------------------------------!
   subroutine nullify_extra2d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext2d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      nullify (scal%d2)

      return
   end subroutine nullify_extra2d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Initialise arrays.                                                                 !
   !---------------------------------------------------------------------------------------!
   subroutine zero_extra2d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext2d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      if(associated(scal%d2)) scal%d2(:,:) = 0.0

      return

   end subroutine zero_extra2d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !     Fill pointers to arrays into variable tables.                                     !
   !---------------------------------------------------------------------------------------!
   subroutine filltab_extra2d(scal2,scalm2,imean,n1,n2,ng,na)
      use var_tables
      implicit none
      !----- Arguments. -------------------------------------------------------------------!
      type(ext2d), intent(inout) :: scal2
      type(ext2d), intent(inout) :: scalm2
      integer    , intent(in)    :: imean
      integer    , intent(in)    :: n1
      integer    , intent(in)    :: n2
      integer    , intent(in)    :: ng
      integer    , intent(in)    :: na
      !----- Local variables. -------------------------------------------------------------!
      integer                    :: npts
      character (len=7)          :: sname
      !------------------------------------------------------------------------------------!

      if (associated(scal2%d2)) then
         npts  = n1*n2
         write(sname,'(a2,i3.3)') 'd2', na
         call vtables2 (scal2%d2,scalm2%d2,ng, npts, imean                                 &
                       ,trim(sname)//' :2:hist:anal:mpti:mpt3')
      end if
      return
   end subroutine filltab_extra2d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Allocate arrays.                                                                   !
   !---------------------------------------------------------------------------------------!
   subroutine alloc_extra3d(scal,m1,m2,m3)

      implicit none
      !----- Arguments. -------------------------------------------------------------------!
      type (ext3d), intent(inout) :: scal
      integer     , intent(in)    :: m1   ! dimension of arrays
      integer     , intent(in)    :: m2   ! dimension of arrays
      integer     , intent(in)    :: m3   ! dimension of arrays
      !------------------------------------------------------------------------------------!

      allocate(scal%d3(m1,m2,m3))

      return
   end subroutine alloc_extra3d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Deallocate arrays.                                                                 !
   !---------------------------------------------------------------------------------------!
   subroutine dealloc_extra3d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext3d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      if (associated(scal%d3)) deallocate(scal%d3)

      return
   end subroutine dealloc_extra3d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Nullify arrays.                                                                    !
   !---------------------------------------------------------------------------------------!
   subroutine nullify_extra3d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext3d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      nullify (scal%d3)

      return
   end subroutine nullify_extra3d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !    Initialise arrays.                                                                 !
   !---------------------------------------------------------------------------------------!
   subroutine zero_extra3d(scal)

      implicit none

      !----- Arguments. -------------------------------------------------------------------!
      type (ext3d), intent(inout) :: scal
      !------------------------------------------------------------------------------------!

      if(associated(scal%d3)) scal%d3(:,:,:) = 0.0

      return

   end subroutine zero_extra3d
   !=======================================================================================!
   !=======================================================================================!






   !=======================================================================================!
   !=======================================================================================!
   !     Fill pointers to arrays into variable tables.                                     !
   !---------------------------------------------------------------------------------------!
   subroutine filltab_extra3d(scal3,scalm3,imean,n1,n2,n3,ng,na)
      use var_tables
      implicit none
      !----- Arguments. -------------------------------------------------------------------!
      type(ext3d), intent(inout) :: scal3
      type(ext3d), intent(inout) :: scalm3
      integer    , intent(in)    :: imean
      integer    , intent(in)    :: n1
      integer    , intent(in)    :: n2
      integer    , intent(in)    :: n3
      integer    , intent(in)    :: ng
      integer    , intent(in)    :: na
      !----- Local variables. -------------------------------------------------------------!
      integer                    :: npts
      character (len=7)          :: sname
      !------------------------------------------------------------------------------------!

      if (associated(scal3%d3)) then
         npts  = n1*n2*n3
         write(sname,'(a2,i3.3)') 'd3', na
         call vtables2 (scal3%d3,scalm3%d3,ng, npts, imean                                 &
                       ,trim(sname)//' :3:hist:anal:mpti:mpt3')
      end if
      return
   end subroutine filltab_extra3d
   !=======================================================================================!
   !=======================================================================================!

end module extras
!==========================================================================================!
!==========================================================================================!
